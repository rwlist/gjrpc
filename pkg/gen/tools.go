package gen

import (
	"fmt"
	"os"

	"github.com/dave/jennifer/jen"
)

const defaultSrcPerm = 0622

func renderToFile(src *jen.File, filename string) error {
	file, err := os.OpenFile(filename, os.O_RDWR|os.O_CREATE, defaultSrcPerm)
	if err != nil {
		return err
	}
	defer file.Close()

	_, err = fmt.Fprint(file, "// Code generated by gjrpc. DO NOT EDIT.\n\n")
	if err != nil {
		return err
	}

	return src.Render(file)
}

func extractByKey(args map[string]string, key string) string {
	value := args[key]
	delete(args, key)
	return value
}
